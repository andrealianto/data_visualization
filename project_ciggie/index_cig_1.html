<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Project Ciggie</title>
        <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
        <link href="main.css" rel="stylesheet" type="text/css">
    </head>

    <body>
        <div class ="frame">
            <div class="header">
                <h2 id="article-headline">Cigarette Regulations in Asia, Country by Country</h2>
                <p id="article-description">
                    Updated 19 March 2017
                    <br>
                    <br>
                    Source: <a href="http://www.tobaccocontrollaws.org/legislation/">Tobacco Control Laws</a>
                </p>
            </div>

            <div class="main-content">
                <div id="button-row-wrapper">
                    <div class="button-row-top">
                        <button class="button-top button-top-active" id="button-advertising">Advertising</button>
                        <button class="button-top" id="button-posdisplay">Point-of-sale Display</button>
                        <button class="button-top" id="button-packaging">Packaging</button>
                        <button class="button-top" id="button-smokingbans">Smoking Bans</button>
                        <button class="button-top" id="button-ecig">E-cigarettes</button>
                    </div>

                    <div id="button-row-bottom-wrapper">
                        <div class="button-row-bottom-active" id="button-row-bottom-advertising">
                            <button class="button-bottom button-bottom-active" id="button-overall-ads">Overall</button>
                            <button class="button-bottom" id="button-media">Media</button>
                            <button class="button-bottom" id="button-outdoor">Outdoor</button>
                            <button class="button-bottom" id="button-sponsorship">Sponsorship</button>
                            <button class="button-bottom" id="button-pos">Point-of-sale</button>
                            <button class="button-bottom" id="button-freesample">Free Sample</button>
                        </div>

                        <div id="button-row-bottom-posdisplay">
                            <button class="button-bottom" id="button-overall-posdisplay">Overall</button>
                            <button class="button-bottom" id="button-posban">POS Display Ban</button>
                            <button class="button-bottom" id="button-restrictedarea">Restricted POS Area</button>
                            <button class="button-bottom" id="button-onepack">One Pack Per Brand</button>
                        </div>

                        <div id="button-row-bottom-packaging">
                            <button class id="button-overall-packaging">Overall</button>
                            <button class id="button-plain">Plain Packaging</button>
                            <button class id="button-pictwarning">Pictorial Warning</button>
                            <button class id="button-packsize">Pack Size Restriction</button>
                        </div>

                        <div id="button-row-bottom-smokingbans">
                            <button class id="button-overall-smokingbans">Overall</button>
                            <button class id="button-bars">Bars/Restaurants</button>
                            <button class id="button-office">Offices</button>
                            <button class id="button-publictransport">Public Transport</button>
                            <button class id="button-school">Schools</button>
                            <button class id="button-hospital">Hospitals</button>
                            <button class id="button-indoor">Indoor Public Area</button>
                        </div>

                        <div id="button-row-bottom-ecig">
                            <button class id="button-overall-ecig">Overall</button>
                            <button class id="button-import">Import</button>
                            <button class id="button-sales">Sales</button>
                            <button class id="button-possession">Possession</button>
                        </div>

                        <div id="button-row-bottom-mask"></div>
                    </div>

                </div>

                <div class="interactive-content">
                    <div id="asia-map"></div>

                    <div id="overview-wrapper">
                        <div id="overview-country-name">Indonesia</div>
                        <div id="overview-toughness-score">
                            <p>TOUGHNESS SCORE</p>
                            <p id="toughness-score">35%</p>
                            <p id="toughness-score-desc">For cigarette advertising</p>
                        </div>

                        <div class="overview-block-active" id="overview-block-advertising">
                            <div class="overview-topic-row">
                                <div class="overview-topic-bullet" id="overview-media-bullet"></div>
                                <div class="overview-info">
                                    <div class="overview-topic">Media: </div>
                                    <div class="overview-topic-desc" id="overview-media-desc"> Allowed</div>
                                </div>
                            </div>

                            <div class="overview-topic-row">
                                <div class="overview-topic-bullet" id="overview-outdoor-bullet"></div>
                                <div class="overview-info">
                                    <div class="overview-topic">Outdoor: </div>
                                    <div class="overview-topic-desc" id="overview-outdoor-desc"> Allowed</div>
                                </div>
                            </div>

                            <div class="overview-topic-row">
                                <div class="overview-topic-bullet" id="overview-sponsorship-bullet"></div>
                                <div class="overview-info">
                                    <div class="overview-topic">Sponsorship: </div>
                                    <div class="overview-topic-desc" id="overview-sponsorship-desc">Allowed</div>
                                </div>
                            </div>

                            <div class="overview-topic-row">
                                <div class="overview-topic-bullet" id="overview-pos-bullet"></div>
                                <div class="overview-info">
                                    <div class="overview-topic">Point-of-sale: </div>
                                    <div class="overview-topic-desc" id="overview-pos-desc">Allowed</div>
                                </div>
                            </div>

                            <div class="overview-topic-row">
                                <div class="overview-topic-bullet" id="overview-freesample-bullet"></div>
                                <div class="overview-info">
                                    <div class="overview-topic">Free sample: </div>
                                    <div class="overview-topic-desc" id="overview-freesample-desc">Allowed</div>
                                </div>
                            </div>
                        </div>

                        <div id="overview-block-posdisplay">
                            <div class="overview-topic-row">
                                <div class="overview-topic-bullet" id="overview-posban-bullet"></div>
                                <div class="overview-info">
                                    <div class="overview-topic">POS Display Ban: </div>
                                    <div class="overview-topic-desc" id="overview-posban-desc"> No</div>
                                </div>
                            </div>

                            <div class="overview-topic-row">
                                <div class="overview-topic-bullet" id="overview-restrictedarea-bullet"></div>
                                <div class="overview-info">
                                    <div class="overview-topic">Restricted POS Area: </div>
                                    <div class="overview-topic-desc" id="overview-restrictedarea-desc"> No</div>
                                </div>
                            </div>

                            <div class="overview-topic-row">
                                <div class="overview-topic-bullet" id="overview-onepack-bullet"></div>
                                <div class="overview-info">
                                    <div class="overview-topic">One Pack Per Brand: </div>
                                    <div class="overview-topic-desc" id="overview-onepack-desc"> No</div>
                                </div>
                            </div>
                        </div>

                        <div id="overview-block-packaging">
                            <div class="overview-topic-row">
                                <div class="overview-topic-bullet" id="overview-plain-bullet"></div>
                                <div class="overview-info">
                                    <div class="overview-topic">Plain Packaging: </div>
                                    <div class="overview-topic-desc" id="overview-plain-desc"> No</div>
                                </div>
                            </div>

                            <div class="overview-topic-row">
                                <div class="overview-topic-bullet" id="overview-pictwarning-bullet"></div>
                                <div class="overview-info">
                                    <div class="overview-topic">Pictorial Warning: </div>
                                    <div class="overview-topic-desc" id="overview-pictwarning-desc"> No</div>
                                </div>
                            </div>

                            <div class="overview-topic-row">
                                <div class="overview-topic-bullet" id="overview-packsize-bullet"></div>
                                <div class="overview-info">
                                    <div class="overview-topic">Pack Size Restriction: </div>
                                    <div class="overview-topic-desc" id="overview-packsize-desc"> No</div>
                                </div>
                            </div>
                        </div>

                        <div id="overview-block-smokingbans">
                            <div class="overview-topic-row">
                                <div class="overview-topic-bullet" id="overview-bars-bullet"></div>
                                <div class="overview-info">
                                    <div class="overview-topic">Bars/Restaurants: </div>
                                    <div class="overview-topic-desc" id="overview-bars-desc"> No</div>
                                </div>
                            </div>

                            <div class="overview-topic-row">
                                <div class="overview-topic-bullet" id="overview-office-bullet"></div>
                                <div class="overview-info">
                                    <div class="overview-topic">Offices: </div>
                                    <div class="overview-topic-desc" id="overview-office-desc"> No</div>
                                </div>
                            </div>

                            <div class="overview-topic-row">
                                <div class="overview-topic-bullet" id="overview-publictransport-bullet"></div>
                                <div class="overview-info">
                                    <div class="overview-topic">Public Transport: </div>
                                    <div class="overview-topic-desc" id="overview-publictransport-desc"> No</div>
                                </div>
                            </div>

                            <div class="overview-topic-row">
                                <div class="overview-topic-bullet" id="overview-school-bullet"></div>
                                <div class="overview-info">
                                    <div class="overview-topic">Schools: </div>
                                    <div class="overview-topic-desc" id="overview-school-desc"> No</div>
                                </div>
                            </div>

                            <div class="overview-topic-row">
                                <div class="overview-topic-bullet" id="overview-hospital-bullet"></div>
                                <div class="overview-info">
                                    <div class="overview-topic">Hospitals: </div>
                                    <div class="overview-topic-desc" id="overview-hospital-desc"> No</div>
                                </div>
                            </div>

                            <div class="overview-topic-row">
                                <div class="overview-topic-bullet" id="overview-indoor-bullet"></div>
                                <div class="overview-info">
                                    <div class="overview-topic">Indoor Public Area: </div>
                                    <div class="overview-topic-desc" id="overview-indoor-desc"> No</div>
                                </div>
                            </div>
                        </div>

                        <div id="overview-block-ecig">
                            <div class="overview-topic-row">
                                <div class="overview-topic-bullet" id="overview-ecig-import-bullet"></div>
                                <div class="overview-info">
                                    <div class="overview-topic">Import: </div>
                                    <div class="overview-topic-desc" id="overview-ecig-import-desc"> No</div>
                                </div>
                            </div>

                            <div class="overview-topic-row">
                                <div class="overview-topic-bullet" id="overview-ecig-sales-bullet"></div>
                                <div class="overview-info">
                                    <div class="overview-topic">Sales: </div>
                                    <div class="overview-topic-desc" id="overview-ecig-sales-desc"> No</div>
                                </div>
                            </div>

                            <div class="overview-topic-row">
                                <div class="overview-topic-bullet" id="overview-ecig-possession-bullet"></div>
                                <div class="overview-info">
                                    <div class="overview-topic">Possession: </div>
                                    <div class="overview-topic-desc" id="overview-ecig-possession-desc"> No</div>
                                </div>
                            </div>
                        </div>

                        <div id="overview-block-mask"></div>

                    </div>
                </div>

            </div>

            <div class="footer">&copy; 2017 Andrea Lianto. All rights reserved.</div>
        </div>

        <script type="text/javascript">

            // draw map
            function draw(geo_data){

                /* LOAD MAP ================================================ */
                var margin = 15,
                    width = 720 - margin,
                    height = 400 - margin;

                var svg = d3.select("#asia-map")
                    .append("svg")
                    .attr("width", width + margin)
                    .attr("height", height + margin)
                    .append('g')
                    .attr('class', 'map');

                var projection = d3.geo.mercator()
                                       .center([87,29])
                                       .scale(550)
                                       .translate([0,0])

                var path = d3.geo.path().projection(projection);

                var map = svg.selectAll('path')
                             .data(geo_data.features)
                             .enter()
                             .append('path')
                             .attr("id", function(d) {return d.properties.brk_name;})
                             .attr("class", "country")
                             .attr('d', path)
                             .on('click', select_country);


                // Pre-select Indonesia at the start
                d3.select('#Indonesia').classed('selected-country', true);

                /* FUNCTIONS =============================================== */
                // Select country on the map
                function select_country(){
                    d3.select('.selected-country').classed('selected-country', false);
                    d3.select(this).classed('selected-country', true);
                    d3.select('#overview-country-name').text(this.id);

                    var selected_category = d3.select('.button-top-active').text();

                    update_toughness_score(this.id, selected_category);
                }

                // Update toughness score
                function update_toughness_score(country_name, selected_category) {
                    var format = d3.format("%");

                    data.forEach(function(d){
                        if(d.country == country_name){
                            switch(selected_category){
                                case "Advertising":
                                    d3.select('#toughness-score').text(format(d.marketing_score));
                                    break;
                                case "Point-of-sale Display":
                                    d3.select('#toughness-score').text(format(d.posDisplay_score));
                                    break;
                                case "Packaging":
                                    d3.select('#toughness-score').text(format(d.packaging_score));
                                    break;
                                case "Smoking Bans":
                                    d3.select('#toughness-score').text(format(d.smokingban_score));
                                    break;
                                case "E-cigarettes":
                                    d3.select('#toughness-score').text(format(d.ecig_score));
                                    break;
                            }


                        }
                    });

                }

                // Update button-row-bottom and overview-block when top buttons are clicked
                function update_display(button_id){
                    d3.select('.button-row-bottom-active').classed('button-row-bottom-active', false);
                    d3.select('.overview-block-active').classed('overview-block-active', false);
                    d3.select('.button-bottom-active').classed('button-bottom-active', false);

                    switch(button_id) {

                        case "button-advertising":
                            d3.select('#button-row-bottom-advertising')
                                .classed('button-row-bottom-active', true);

                            d3.select('#overview-block-advertising')
                                .classed('overview-block-active', true);

                            d3.select('#toughness-score-desc')
                                .text('For cigarette advertising');

                            d3.select('#button-overall-ads')
                                .classed('button-bottom-active', true);

                            d3.selectAll('.country')
                                .style('fill', '#cb2f27');

                            break;

                        case "button-posdisplay":
                            d3.select('#button-row-bottom-posdisplay')
                                .classed('button-row-bottom-active', true);

                            d3.select('#overview-block-posdisplay')
                                .classed('overview-block-active', true);

                            d3.select('#toughness-score-desc')
                                .text('For point-of-sale cigarette display');

                            d3.select('#button-overall-posdisplay')
                                .classed('button-bottom-active', true);

                            d3.selectAll('.country')
                                .style('fill', '#f0bd56');

                            break;

                        case "button-packaging":
                            d3.select('#button-row-bottom-packaging')
                                .classed('button-row-bottom-active', true);

                            d3.select('#overview-block-packaging')
                                .classed('overview-block-active', true);

                            d3.select('#toughness-score-desc')
                                .text('For cigarette packaging');

                            d3.select('#button-overall-packaging')
                                .classed('button-bottom-active', true);

                            d3.selectAll('.country')
                                .style('fill', '#0061a6');

                            break;

                        case "button-smokingbans":
                            d3.select('#button-row-bottom-smokingbans')
                                .classed('button-row-bottom-active', true);

                            d3.select('#overview-block-smokingbans')
                                .classed('overview-block-active', true);

                            d3.select('#toughness-score-desc')
                                .text('For smoking bans');

                            d3.select('#button-overall-smokingbans')
                                .classed('button-bottom-active', true);

                            d3.selectAll('.country')
                                .style('fill', '#87bb40');

                            break;

                        case "button-ecig":
                            d3.select('#button-row-bottom-ecig')
                                .classed('button-row-bottom-active', true);

                            d3.select('#overview-block-ecig')
                                .classed('overview-block-active', true);

                            d3.select('#toughness-score-desc')
                                .text('For e-cigarettes');

                            d3.select('#button-overall-ecig')
                                .classed('button-bottom-active', true);

                            d3.selectAll('.country')
                                .style('fill', '#833e98');

                            break;
                    }
                }

                // Update map shading for Advertising category
                function update_map_shading_advertising(selected_subcategory) {

                    data.forEach(function(d) {
                        current_country = d3.select("#" + d.country);

                        var selected_column;

                        switch(selected_subcategory) {
                            case "button-overall-ads":
                                selected_column = d.marketing_score; break;
                            case "button-media":
                                selected_column = d.marketing_media; break;
                            case "button-outdoor":
                                selected_column = d.marketing_outdoor; break;
                            case "button-sponsorship":
                                selected_column = d.marketing_event; break;
                            case "button-freesample":
                                selected_column = d.marketing_sample; break;
                            case "button-pos":
                                selected_column = d.marketing_posAds; break;
                        }

                        switch(selected_column) {
                            case "no":
                                current_country.style("fill-opacity", "1"); break;
                            case "yes":
                                current_country.style("fill-opacity", "0"); break;
                            case "restricted":
                                current_country.style("fill-opacity", "0.5"); break;
                            case "NA":
                                current_country.style("fill", "#EEEEEE"); break;
                            default:
                                current_country.style("fill-opacity", selected_column); break;

                        }
                    });
                }

                function update_map_shading_posdisplay(selected_subcategory) {
                    data.forEach(function(d) {
                        current_country = d3.select("#" + d.country);

                        var selected_column;

                        switch(selected_subcategory) {
                            case "button-overall-posdisplay":
                                selected_column = d.posDisplay_score; break;
                            case "button-posban":
                                selected_column = d.posDisplay_banned; break;
                            case "button-restrictedarea":
                                selected_column = d.posDisplay_restrictedArea; break;
                            case "button-onepack":
                                selected_column = d.posDisplay_onePackPerBrand; break;

                        }

                        switch(selected_column) {
                            case "no":
                                current_country.style("fill-opacity", "0"); break;
                            case "yes":
                                current_country.style("fill-opacity", "1"); break;
                            case "NA":
                                current_country.style("fill", "#EEEEEE"); break;
                            default:
                                current_country.style("fill-opacity", selected_column); break;

                        }
                    });
                }

                function update_map_shading_packaging(selected_subcategory) {

                }

                function update_map_shading_smokingbans(selected_subcategory) {

                }

                function update_map_shading_ecig(selected_subcategory) {

                }





                /* ADD CLICK FUNCTION TO TOP-ROW BUTTONS ==================== */
                var button_top = d3.selectAll(".button-top");

                button_top.on("click", function() {
                    d3.select('.button-top-active').classed('button-top-active', false);
                    d3.select(this).classed('button-top-active', true);
                    update_display(this.id);

                    var country_name = d3.select("#overview-country-name").text();
                    update_toughness_score(country_name, this.textContent);
                });

                /* ADD CLICK FUNCTION TO BOTTOM-ROW BUTTONS ================ */
                var button_bottom = d3.selectAll(".button-bottom");

                button_bottom.on("click", function() {
                    d3.select('.button-bottom-active').classed('button-bottom-active', false);
                    d3.select(this).classed('button-bottom-active', true);

                    // var country_name = d3.select("overview-country-name").text();
                    var selected_category = d3.select(".button-top-active").text();
                    var selected_subcategory = this.id;

                    switch(selected_category) {
                        case "Advertising":
                            d3.selectAll('.country')
                                .style('fill', '#cb2f27')
                                .style('fill-opacity', '1');
                            update_map_shading_advertising(selected_subcategory);
                            break;
                        case "Point-of-sale Display":
                            d3.selectAll('.country')
                                .style('fill', '#f0bd56')
                                .style('fill-opacity', "1");
                            update_map_shading_posdisplay(selected_subcategory);
                            break;
                        case "Packaging":
                            d3.selectAll('.country')
                                .style('fill', '#0061a6')
                                .style('fill-opacity', '1');
                            update_map_shading_packaging(selected_subcategory);
                            break;
                        case "Smoking Bans":
                            d3.selectAll('.country')
                                .style('fill', '#87bb40')
                                .style('fill-opacity', '1');
                            update_map_shading_smokingbans(selected_subcategory);
                            break;
                        case "E-cigarettes":
                            d3.selectAll('.country')
                                .style('fill', '#833e98')
                                .style('fill-opacity', '1');
                            update_map_shading_ecig(selected_subcategory);
                            break;
                    }

                });

            }

            // Use D3 to load GeoJSON data for Asia
            d3.json("asean.json", draw);

            /* LOAD CSV =============================================== */
            //var format = d3.format("%");
            var data;
            d3.csv("cig_regulation_asia.csv", function(d) {
                d['packaging_score'] = +d['packaging_score'];
                d['ecig_score'] = +d['ecig_score'];
                d['marketing_score'] = +d['marketing_score'];
                d['posDisplay_score'] = +d['posDisplay_score'];
                d['smokingban_score'] = +d['smokingban_score'];
                return d;
            }, load);

            function load(d){
                data = d;
            }


        </script>

    </body>

</html>